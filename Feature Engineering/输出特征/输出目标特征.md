# 钙钛矿太阳能电池性能目标特征

本特征集结合了可从 Perovskite Database 直接下载的实验性能数据和可通过简单 DFT 计算补充的理论性能数据。

## 1. 可直接下载的实验性能数据

### 1.1 核心器件性能指标 (4维)

基于 Perovskite Database 的 42,400+ 器件实测数据：

| 特征名称                          | 中文名称     | 数据类型 | 数据库字段 | 物理意义                         |
| --------------------------------- | ------------ | -------- | ---------- | -------------------------------- |
| `power_conversion_efficiency`   | 光电转换效率 | float    | PCE        | 太阳能电池的能量转换效率 (%)     |
| `open_circuit_voltage`          | 开路电压     | float    | Voc        | 器件的最大输出电压 (V)           |
| `short_circuit_current_density` | 短路电流密度 | float    | Jsc        | 器件的最大输出电流密度 (mA/cm²) |
| `fill_factor`                   | 填充因子     | float    | FF         | J-V曲线的方形度 (%)              |

### 1.2 光电特性参数 (3维)

| 特征名称                            | 中文名称       | 数据类型 | 数据库字段 | 物理意义                  |
| ----------------------------------- | -------------- | -------- | ---------- | ------------------------- |
| `bandgap_experimental`            | 实验带隙       | float    | Eg         | 从光学测量得到的带隙 (eV) |
| `external_quantum_efficiency_max` | 最大外量子效率 | float    | EQE_max    | 器件的最大外量子效率 (%)  |
| `light_intensity`                 | 测试光强       | float    | 数据库提供 | 性能测试时的光照强度      |

### 1.3 稳定性性能 (3维)

基于数据库中约 7,400 条稳定性数据：

| 特征名称                         | 中文名称       | 数据类型 | 数据库字段 | 物理意义                   |
| -------------------------------- | -------------- | -------- | ---------- | -------------------------- |
| `t80_stability`                | T80稳定性时间  | float    | T80        | 效率降到80%所需时间 (小时) |
| `stability_test_condition`     | 稳定性测试条件 | str      | 数据库提供 | 测试条件：AM1.5、MPPT等    |
| `initial_efficiency_retention` | 初始效率保持率 | float    | 数据库提供 | 特定时间后的效率保持百分比 |

## 2. 简单DFT计算补充特征

对于数据库中缺失的理论性能，可通过 GPAW 简单计算补充：

### 2.1 基础电子结构特征 (3维)

| 特征名称             | 中文名称    | 计算方法       | 用途               |
| -------------------- | ----------- | -------------- | ------------------ |
| `bandgap_dft`      | DFT计算带隙 | GPAW PBE计算   | 补充缺失的带隙数据 |
| `formation_energy` | 形成能      | GPAW总能量计算 | 预测材料稳定性     |
| `work_function`    | 功函数      | GPAW表面计算   | 界面能级匹配分析   |

### 2.2 快速筛选计算特征 (2维)

| 特征名称                       | 中文名称     | 计算方法     | 用途             |
| ------------------------------ | ------------ | ------------ | ---------------- |
| `dielectric_constant_static` | 静态介电常数 | GPAW介电响应 | 激子结合能估算   |
| `effective_mass_average`     | 平均有效质量 | GPAW能带拟合 | 载流子迁移率估算 |

## 数据下载和计算流程

### 步骤1: 下载实验数据

```python
import pandas as pd

# 从 Perovskite Database 下载实验数据
df = pd.read_csv('perovskite_database.csv')

# 提取性能目标特征
performance_features = df[[
    'PCE',  # 光电转换效率
    'Voc',  # 开路电压  
    'Jsc',  # 短路电流密度
    'FF',   # 填充因子
    'Eg',   # 带隙
    'EQE_max',  # 最大外量子效率
    'T80',  # 稳定性时间
    'Cell_area_measured',  # 器件面积
    'Ref_diode_factor'     # 二极管因子
]].copy()

print(f"实验数据覆盖率:")
print(performance_features.isnull().sum() / len(df) * 100)
```

### 步骤2: DFT计算补充缺失数据

```python
from gpaw import GPAW, PW, FermiDirac
from ase.io import read

def calculate_missing_properties(cif_file):
    """为缺失数据的材料进行简单DFT计算"""
  
    # 读取优化后的结构
    atoms = read(cif_file)
  
    # 设置GPAW计算器 - 快速计算模式
    calc = GPAW(
        mode=PW(400),  # 较低截断能，快速计算
        xc='PBE',
        kpts={'size': (2, 2, 2), 'gamma': True},  # 较稀疏k点
        occupations=FermiDirac(0.1),
        txt='quick_calc.txt'
    )
  
    atoms.calc = calc
    energy = atoms.get_potential_energy()
  
    # 计算带隙（简单方法）
    # 这里可以添加更详细的带隙计算代码
  
    return {
        'bandgap_dft': 0.0,  # 实际计算值
        'formation_energy': energy,
        'work_function': 0.0  # 实际计算值
    }
```

### 步骤3: 数据整合

```python
# 整合实验数据和计算数据
def combine_experimental_and_computational_data():
    # 加载实验数据
    exp_data = pd.read_csv('perovskite_database.csv')
  
    # 对于缺失带隙的材料，使用DFT计算补充
    missing_bandgap = exp_data['Eg'].isnull()
  
    for idx in exp_data[missing_bandgap].index:
        # 这里调用DFT计算
        # calculated_props = calculate_missing_properties(cif_file)
        # exp_data.loc[idx, 'Eg'] = calculated_props['bandgap_dft']
        pass
  
    return exp_data
```

## 特征优先级和应用策略

### 高优先级特征（直接可用）

1. **PCE, Voc, Jsc, FF**: 核心性能指标，数据完整度高
2. **钙钛矿组成 + 带隙**: 材料筛选的关键特征
3. **器件面积 + 效率**: 可扩展性分析

### 中优先级特征（部分数据）

1. **稳定性数据**: 约17%的器件有数据，但质量高
2. **外量子效率**: 部分器件提供，用于光学性能分析

### 低优先级特征（DFT补充）

1. **形成能**: 用于新材料稳定性预测
2. **功函数**: 用于界面设计优化

## 数据质量说明

基于 Nature Energy 论文的统计：

- **总器件数**: 42,400+
- **PCE数据覆盖率**: >95%
- **J-V特征覆盖率**: >90%
- **稳定性数据覆盖率**: ~17%
- **带隙数据覆盖率**: ~80%

这种组合策略确保了：

1. **核心特征完全基于实验数据**（高可信度）
2. **缺失数据可通过快速DFT计算补充**（保持完整性）
3. **支持大规模材料筛选和性能预测**（实用性）
